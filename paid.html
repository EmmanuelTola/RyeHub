<!DOCTYPE html>
<head>
<meta property="og:image" content="https://ryehub.vercel.app/banner.jpg" />
<link rel="shortcut icon" type="image/jpg" href="https://ryehub.vercel.app/logo.jpg">
<meta data-react-helmet="true" name="description" content="Get the best products with easy shopping online. Connect with sellers and customers and enjoy great deal on RyeHub"/>
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Cart | RyeHub">
<meta property="twitter:description" content="Get the best products with easy shopping online. Connect with sellers and customers and enjoy great deal on RyeHub">
<meta property="twitter:image" content="https://ryehub.vercel.app/logo.jpg">	
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta property="og:type" content="website"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">



 <title>Cart | RyeHub</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HexxeJS/HexxeDB@main/hex.css">
<script src="https://cdn.jsdelivr.net/gh/HexxeJS/HexxeDB@main/hex.js"></script>
<script src="https://cdn.jsdelivr.net/gh/HexxeJS/HexxeDB/que.js"></script>
<script src="https://cdn.jsdelivr.net/gh/HexxeJS/HexxeDB/query.js"></script>


<body>

<style>
 
html, body {
margin: 0;
} 

.item {
width: 95%;
margin-left: 2.5%; 
}

.custom-spin {
  animation-duration: 1s; /* Change the duration to adjust the speed */
}    
</style>

<center>
<i margin="10px top" id="loader" size="100px" class="fas fa-circle-notch fa-spin custom-spin"></i>
<br>
<p width="80%" font="Outfit" size="15px">Processing... Do Not Leave This Window</p>
</center>  

<script parse="getMen();">

$IMPORT('@UI');    

const $con = "q2goAPe9YRLIWeWI75Iw"; 
const $db = "ryehub"; 
$START('XQL:'+$con);
let $prod = []; 
$QUERY($con, $db, 'SELECT products').pull(getUsers); 
function getUsers(data) { 
$prod = data;  
doPaid();
}

function doPaid(){
try{
const keys = Object.keys(localStorage);
if (keys.some(key => key.startsWith("rye-"))) {
for (let i = 0; i < keys.length; i++) {
  const key = keys[i];
if (key.startsWith("rye-")) {
    // Do something with key

  
let value = localStorage.getItem(key);
let rid = key.split("rye-").pop(); 
let time = $date(); 
let buyer = localStorage.getItem('rye'); 
if(!checkData(buyer)){ buyer = "Visitor"; }
let qty = localStorage.getItem(key);  
let prod = $prod.filter(item => item['id'] == rid); 
if(prod && prod[0]) {
prod = prod[0]; 
item = rid; 
let price = prod.price;
if(checkData(prod.discount)){ price = prod.discount; }
if(prod.currency == "$"){} else {
price = Number(price) / 1372; 

}
let seller = prod.userid; 
let num = 0; 
let whole = localStorage.getItem("fee-"+seller); 
if(checkData(whole)){
num = whole.split("-")[0]; 
let coin = whole.split("-").pop(); 
if(coin == "$") {} else {
num = Number(num) / 1372;
num = num.toFixed(2); 
}
}
price = Number(price) + Number(num); 
price = price.toFixed(2); 

let status = "pending";
let size = localStorage.getItem("spec-"+item); 
if(!checkData(size)) {
size = "none"; 
}
let location = localStorage.getItem("ryeadd"); 
location = location.replace(/,/g, " "); 
localStorage.removeItem(key); 
localStorage.removeItem("spec-"+rid); 
let db = $db; 
let call = `$UPDATE('${db}', "UPDATE seller SET earn = 'earn ++ ${price}' WHERE id = '${seller}'", "doPaid()")`; 
$INSERT($db, `INSERT purchases FIELDS(buyer, item, qty, price, seller, status, size, location, time) VALUES(${buyer}, ${item}, ${qty}, ${price}, ${seller}, ${status}, ${size}, ${location}, ${time})`, call); 
break; 
}
}}
} else {
sendMail(); 
}
} catch(error) {
alert(error); 
}}

function sendMail() {

try {
  let from = "RyeHub-Receipt@ryehub.com"; 
let to = localStorage.getItem("ryemail");
let body = localStorage.getItem("ryerec"); 
let head = "RYEHUB PURCHASE RECEIPT"; 
let call = `location.href = "user.html"`; 
Mailer(to, from, head, body, call, 'alert("error")'); 
} catch(err) {
alert(err); 
  }



}



</script>
        

